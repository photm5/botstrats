#!/bin/bash

{
    sleep $(cat $scripts_dir/actions/scan/costs/$from_type)

    range=$(cat $scripts_dir/actions/scan/ranges/$from_type)

    cd robots
    while read robot_uuid
    do
        robot_distance $from_uuid $robot_uuid
        [[ $distance -lt $range ]] || continue
        cd $robot_uuid
        new=$({
            printf '{"type":"%s",' $(cat type)
            printf '"x":"%s",' $(cat position/x)
            printf '"y":"%s",' $(cat position/y)
            printf '"uuid":"%s"}' $robot_uuid
        })
        if [[ $results ]]
        then
            results="$results,$new"
        else
            results="$new"
        fi
        cd ..
    done < <(ls -1)

    result "success [$results]"
} &
